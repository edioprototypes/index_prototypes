<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Consulta Webhook</title>

    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f0f0f0;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      button {
        padding: 10px 20px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
      }

      button:hover {
        background-color: #45a049;
      }

      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }

      .results-container {
        margin-top: 20px;
      }

      .data-item {
        padding: 10px;
        border-bottom: 1px solid #ddd;
        margin-bottom: 5px;
      }

      .data-item:last-child {
        border-bottom: none;
      }

      #loading {
        display: none;
        margin-top: 10px;
        font-size: 18px;
        color: #555;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Consulta de Dados</h1>
      <button onclick="searchData()" id="searchButton">Buscar Dados</button>
      <div id="loading">Carregando...</div>
      <div id="results" class="results-container"></div>
    </div>

    <script>
      async function searchData() {
        const button = document.getElementById("searchButton");
        const loading = document.getElementById("loading");
        const resultsContainer = document.getElementById("results");

        button.disabled = true; // Desabilita o botão durante a requisição
        loading.style.display = "block"; // Exibe o spinner
        resultsContainer.innerHTML = ""; // Limpa resultados anteriores

        try {
          const response = await fetch(
            "https://webhook.ediogoncalvesdev.com.br/webhook/busca_salvos",
            { method: "GET" }
          );

          if (!response.ok) {
            throw new Error(`Erro na requisição: ${response.status}`);
          }

          const data = await response.json();
          console.log("Dados recebidos:", data); // Log dos dados recebidos para depuração

          // Verifica se os dados são um array ou estão dentro de um objeto
          let resultsArray = [];
          if (Array.isArray(data)) {
            resultsArray = data;
          } else if (data && typeof data === "object") {
            const keys = Object.keys(data);
            if (keys.length === 1 && Array.isArray(data[keys[0]])) {
              resultsArray = data[keys[0]]; // Se os dados vierem dentro de um objeto
            }
          }

          if (resultsArray.length > 0) {
            displayResults(resultsArray);
          } else {
            resultsContainer.innerHTML = "<p>Nenhum dado encontrado</p>";
          }
        } catch (error) {
          console.error("Erro:", error);
          resultsContainer.innerHTML =
            "<p>Ocorreu um erro ao buscar os dados</p>";
        } finally {
          button.disabled = false; // Reabilita o botão
          loading.style.display = "none"; // Oculta o spinner
        }
      }

      function displayResults(data) {
        const resultsContainer = document.getElementById("results");

        resultsContainer.innerHTML = ""; // Limpa os resultados anteriores

        data.forEach((item) => {
          const div = document.createElement("div");
          div.className = "data-item";

          div.innerHTML = `
            <p><strong>ID:</strong> ${item.id}</p>
            <p><strong>Nome:</strong> ${item.title.trim()}</p>
            <p><strong>Avaliação:</strong> ${item.rating}</p>
            <p><strong>Endereço:</strong> ${item.address}</p>
            <p><strong>Telefone:</strong> ${item.phone}</p>
            <p><strong>Website:</strong> ${
              item.website !== "null"
                ? `<a href="${item.website}" target="_blank">${item.website}</a>`
                : "Não disponível"
            }</p>
            <hr>
          `;

          resultsContainer.appendChild(div);
        });
      }
    </script>
  </body>
</html>
